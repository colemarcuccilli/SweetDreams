# Development Setup Checklist

This guide walks you through setting up the Sweet Dreams Music Dream Suite development environment from scratch.

## Prerequisites

- Node.js 18+ installed
- Git installed
- GitHub account
- Code editor (VS Code recommended)
- Terminal access

---

## Phase 1: Initial Project Setup

### 1.1 Clone Repository
```bash
cd ~/Desktop/SweetDreamsMusicLLC
git clone <repo-url> SweetDreams
cd SweetDreams
```

### 1.2 Install Dependencies
```bash
npm install
```

**Key Dependencies:**
- `next` - Next.js 14+ framework
- `react` & `react-dom` - React 18+
- `@supabase/supabase-js` & `@supabase/ssr` - Supabase client
- `langchain` & `@langchain/openai` - AI agents
- `@mendable/firecrawl-js` - Web scraping
- `stripe` - Payment processing
- `zod` - Schema validation
- `react-hook-form` - Form handling
- `@radix-ui/*` - shadcn/ui components
- `tailwindcss` - Styling

### 1.3 Create Environment File
```bash
cp .env.example .env.local
```

Fill in ALL environment variables from `INTEGRATIONS-SETUP.md`.

### 1.4 Verify Installation
```bash
npm run dev
```

Visit `http://localhost:3000` - should see Next.js welcome page.

---

## Phase 2: Database Setup (Supabase)

### 2.1 Create Supabase Project
1. Go to [supabase.com](https://supabase.com)
2. Create new project: `sweet-dreams-dream-suite`
3. Save database password securely

### 2.2 Run Database Migrations
```sql
-- Run in Supabase SQL Editor

-- 1. Users table (extends auth.users)
CREATE TABLE public.users (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email VARCHAR(255) UNIQUE NOT NULL,
  full_name VARCHAR(255),
  artist_name VARCHAR(255),
  role VARCHAR(20) NOT NULL DEFAULT 'artist',

  -- Brand Identity
  brand_why TEXT,
  brand_values JSONB,
  genre VARCHAR(100),

  -- Gamification
  xp INTEGER DEFAULT 0,
  level INTEGER DEFAULT 1,
  current_tier INTEGER DEFAULT 1,
  posting_streak INTEGER DEFAULT 0,
  last_post_date DATE,

  -- Platform Connections
  instagram_token TEXT,
  instagram_token_expires_at TIMESTAMPTZ,
  instagram_username VARCHAR(255),
  spotify_artist_id VARCHAR(255),
  tiktok_username VARCHAR(255),

  -- Subscription
  subscription_tier VARCHAR(50) DEFAULT 'free',
  subscription_status VARCHAR(50) DEFAULT 'active',
  stripe_customer_id VARCHAR(255),

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. Daily Metrics (collected by n8n)
CREATE TABLE daily_metrics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  artist_id UUID REFERENCES users(id) ON DELETE CASCADE,
  platform VARCHAR(50) NOT NULL,
  collected_at TIMESTAMPTZ DEFAULT NOW(),

  -- Metrics
  follower_count INTEGER,
  post_count INTEGER,
  engagement_rate DECIMAL(5, 2),
  views INTEGER,
  likes INTEGER,
  comments INTEGER,
  shares INTEGER,
  saves INTEGER,

  -- Raw data
  raw_data JSONB
);

CREATE INDEX idx_daily_metrics_artist ON daily_metrics(artist_id);
CREATE INDEX idx_daily_metrics_collected ON daily_metrics(collected_at);

-- 3. Content Posts (post-level data)
CREATE TABLE content_posts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  artist_id UUID REFERENCES users(id) ON DELETE CASCADE,
  platform VARCHAR(50) NOT NULL,
  post_id VARCHAR(255) NOT NULL,
  post_type VARCHAR(50),
  posted_at TIMESTAMPTZ NOT NULL,

  -- Metrics
  views INTEGER,
  likes INTEGER,
  comments INTEGER,
  shares INTEGER,
  saves INTEGER,
  engagement_rate DECIMAL(5, 2),

  -- Content
  caption TEXT,
  media_url TEXT,
  thumbnail_url TEXT,

  collected_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_content_posts_artist ON content_posts(artist_id);
CREATE INDEX idx_content_posts_posted ON content_posts(posted_at);

-- 4. AI Insights (generated by LangChain agents)
CREATE TABLE ai_insights (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  artist_id UUID REFERENCES users(id) ON DELETE CASCADE,
  insight_type VARCHAR(100) NOT NULL,
  title VARCHAR(255) NOT NULL,
  content TEXT NOT NULL,
  data JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_ai_insights_artist ON ai_insights(artist_id);
CREATE INDEX idx_ai_insights_created ON ai_insights(created_at);

-- 5. Dashboard Messages (Vote of Confidence)
CREATE TABLE dashboard_messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  artist_id UUID REFERENCES users(id) ON DELETE CASCADE,
  message TEXT NOT NULL,
  message_type VARCHAR(50) DEFAULT 'vote_of_confidence',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  read BOOLEAN DEFAULT FALSE
);

CREATE INDEX idx_dashboard_messages_artist ON dashboard_messages(artist_id);

-- 6. Gamification
CREATE TABLE artist_gamification (
  artist_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,
  xp INTEGER DEFAULT 0,
  level INTEGER DEFAULT 1,
  current_tier INTEGER DEFAULT 1,
  posting_streak INTEGER DEFAULT 0,
  last_post_date DATE,
  longest_streak INTEGER DEFAULT 0,
  total_posts INTEGER DEFAULT 0,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 7. Achievements
CREATE TABLE achievement_definitions (
  id VARCHAR(100) PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  description TEXT NOT NULL,
  category VARCHAR(50) NOT NULL,
  xp_reward INTEGER NOT NULL,
  cosmetic_unlock VARCHAR(100),
  criteria JSONB NOT NULL
);

CREATE TABLE artist_achievements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  artist_id UUID REFERENCES users(id) ON DELETE CASCADE,
  achievement_id VARCHAR(100) REFERENCES achievement_definitions(id),
  unlocked_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(artist_id, achievement_id)
);

CREATE INDEX idx_artist_achievements_artist ON artist_achievements(artist_id);

-- 8. Avatar Cosmetics
CREATE TABLE avatar_cosmetics (
  id VARCHAR(100) PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  category VARCHAR(50) NOT NULL,
  rarity VARCHAR(50) NOT NULL,
  image_url TEXT,
  unlock_requirement VARCHAR(100)
);

CREATE TABLE avatar_cosmetics_unlocked (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  artist_id UUID REFERENCES users(id) ON DELETE CASCADE,
  cosmetic_id VARCHAR(100) REFERENCES avatar_cosmetics(id),
  unlocked_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(artist_id, cosmetic_id)
);

CREATE INDEX idx_avatar_cosmetics_unlocked_artist ON avatar_cosmetics_unlocked(artist_id);

-- 9. Agent Cache (for cost optimization)
CREATE TABLE agent_cache (
  cache_key VARCHAR(255) PRIMARY KEY,
  output JSONB NOT NULL,
  expires_at TIMESTAMPTZ NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_agent_cache_expires ON agent_cache(expires_at);

-- 10. Playlist Opportunities (from Firecrawl)
CREATE TABLE playlist_opportunities (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  artist_id UUID REFERENCES users(id) ON DELETE CASCADE,
  playlist_name VARCHAR(255) NOT NULL,
  curator_name VARCHAR(255),
  follower_count INTEGER,
  genres JSONB,
  reason TEXT,
  spotify_url VARCHAR(500),
  discovered_at TIMESTAMPTZ DEFAULT NOW(),
  contacted BOOLEAN DEFAULT FALSE,
  status VARCHAR(50) DEFAULT 'pending'
);

CREATE INDEX idx_playlist_opportunities_artist ON playlist_opportunities(artist_id);

-- 11. Industry Trends (from Firecrawl)
CREATE TABLE industry_trends (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  source VARCHAR(255) NOT NULL,
  source_url TEXT,
  trend VARCHAR(500) NOT NULL,
  opportunity TEXT,
  actions JSONB,
  difficulty VARCHAR(20),
  impact VARCHAR(20),
  discovered_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_industry_trends_discovered ON industry_trends(discovered_at);
```

### 2.3 Enable Row Level Security
```sql
-- Enable RLS on all tables
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE daily_metrics ENABLE ROW LEVEL SECURITY;
ALTER TABLE content_posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE ai_insights ENABLE ROW LEVEL SECURITY;
ALTER TABLE dashboard_messages ENABLE ROW LEVEL SECURITY;
ALTER TABLE artist_gamification ENABLE ROW LEVEL SECURITY;
ALTER TABLE artist_achievements ENABLE ROW LEVEL SECURITY;
ALTER TABLE avatar_cosmetics_unlocked ENABLE ROW LEVEL SECURITY;
ALTER TABLE playlist_opportunities ENABLE ROW LEVEL SECURITY;

-- Users can view their own data
CREATE POLICY "Users can view own profile"
ON users FOR SELECT
USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
ON users FOR UPDATE
USING (auth.uid() = id);

CREATE POLICY "Artists can view their own metrics"
ON daily_metrics FOR SELECT
USING (auth.uid() = artist_id);

CREATE POLICY "Artists can view their own insights"
ON ai_insights FOR SELECT
USING (auth.uid() = artist_id);

CREATE POLICY "Artists can view their own messages"
ON dashboard_messages FOR SELECT
USING (auth.uid() = artist_id);

CREATE POLICY "Artists can mark messages as read"
ON dashboard_messages FOR UPDATE
USING (auth.uid() = artist_id);

-- Service role has full access (for n8n, cron jobs)
CREATE POLICY "Service role full access to metrics"
ON daily_metrics FOR ALL
USING (auth.jwt()->>'role' = 'service_role');

CREATE POLICY "Service role full access to insights"
ON ai_insights FOR ALL
USING (auth.jwt()->>'role' = 'service_role');

CREATE POLICY "Service role full access to messages"
ON dashboard_messages FOR ALL
USING (auth.jwt()->>'role' = 'service_role');
```

### 2.4 Seed Achievement Definitions
```sql
INSERT INTO achievement_definitions (id, name, description, category, xp_reward, cosmetic_unlock, criteria) VALUES
  ('first_week_strong', 'First Week Strong', 'Maintained a 7-day posting streak', 'consistency', 200, 'hustler_hoodie', '{"type": "posting_streak", "days": 7}'),
  ('one_thousand_strong', 'One Thousand Strong', 'Reached 1,000 followers', 'growth', 500, 'gold_mic', '{"type": "follower_milestone", "count": 1000}'),
  ('viral_moment', 'Viral Moment', 'Posted content that reached 100k+ views', 'engagement', 1000, 'fire_emoji', '{"type": "views_milestone", "count": 100000}'),
  ('consistent_creator', 'Consistent Creator', 'Posted 30 days in a row', 'consistency', 1000, 'crown', '{"type": "posting_streak", "days": 30}');
```

---

## Phase 3: Project Structure Setup

### 3.1 Create Directory Structure
```bash
mkdir -p app/api/auth
mkdir -p app/api/webhooks/stripe
mkdir -p app/api/webhooks/n8n
mkdir -p app/api/cron
mkdir -p app/dashboard
mkdir -p app/lib/supabase
mkdir -p app/lib/openai
mkdir -p app/lib/stripe
mkdir -p app/lib/firecrawl
mkdir -p app/lib/orchestration
mkdir -p app/components/ui
mkdir -p app/components/dashboard
mkdir -p app/components/insights
mkdir -p app/actions
```

### 3.2 Install shadcn/ui
```bash
npx shadcn-ui@latest init
```

Configure:
- TypeScript: Yes
- Style: Default
- Base color: Slate
- CSS variables: Yes

Add essential components:
```bash
npx shadcn-ui@latest add button
npx shadcn-ui@latest add card
npx shadcn-ui@latest add input
npx shadcn-ui@latest add form
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add toast
npx shadcn-ui@latest add dropdown-menu
npx shadcn-ui@latest add avatar
```

### 3.3 Configure Tailwind CSS
```javascript
// tailwind.config.ts
export default {
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        brand: {
          purple: '#8B5CF6',
          pink: '#EC4899',
          blue: '#3B82F6',
        },
      },
    },
  },
  plugins: [require('tailwindcss-animate')],
}
```

---

## Phase 4: Core Utilities Setup

### 4.1 Supabase Client
```typescript
// app/lib/supabase/client.ts
import { createBrowserClient } from '@supabase/ssr';

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );
}
```

```typescript
// app/lib/supabase/server.ts
import { createServerClient, type CookieOptions } from '@supabase/ssr';
import { cookies } from 'next/headers';

export function createClient() {
  const cookieStore = cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return cookieStore.get(name)?.value;
        },
        set(name: string, value: string, options: CookieOptions) {
          cookieStore.set({ name, value, ...options });
        },
        remove(name: string, options: CookieOptions) {
          cookieStore.delete({ name, ...options });
        },
      },
    }
  );
}
```

### 4.2 Middleware for Auth
```typescript
// app/middleware.ts
import { NextResponse, type NextRequest } from 'next/server';
import { createServerClient } from '@supabase/ssr';

export async function middleware(request: NextRequest) {
  let response = NextResponse.next();

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return request.cookies.get(name)?.value;
        },
        set(name: string, value: string, options: any) {
          response.cookies.set({ name, value, ...options });
        },
        remove(name: string, options: any) {
          response.cookies.set({ name, value: '', ...options });
        },
      },
    }
  );

  const { data: { user } } = await supabase.auth.getUser();

  if (request.nextUrl.pathname.startsWith('/dashboard') && !user) {
    return NextResponse.redirect(new URL('/login', request.url));
  }

  return response;
}

export const config = {
  matcher: ['/dashboard/:path*'],
};
```

### 4.3 Firecrawl Client
```typescript
// app/lib/firecrawl/client.ts
import FirecrawlApp from '@mendable/firecrawl-js';

export const firecrawl = new FirecrawlApp({
  apiKey: process.env.FIRECRAWL_API_KEY!
});

export async function scrapePage(url: string) {
  try {
    const result = await firecrawl.scrapeUrl(url, {
      formats: ['markdown'],
      onlyMainContent: true
    });
    return result;
  } catch (error) {
    console.error('Firecrawl error:', error);
    throw error;
  }
}
```

---

## Phase 5: Vercel Configuration

### 5.1 Create vercel.json
```json
{
  "crons": [
    {
      "path": "/api/cron/trigger-data-collection",
      "schedule": "0 2 * * *"
    },
    {
      "path": "/api/cron/run-daily-analysis",
      "schedule": "0 3 * * *"
    },
    {
      "path": "/api/cron/generate-votes-of-confidence",
      "schedule": "0 4 * * *"
    }
  ]
}
```

### 5.2 Deploy to Vercel
```bash
# Install Vercel CLI
npm i -g vercel

# Login
vercel login

# Deploy
vercel

# Production
vercel --prod
```

---

## Phase 6: n8n Workflow Setup

### 6.1 Choose Deployment Method
- **n8n Cloud** ($20/month) - Easiest
- **Self-host** (Railway, Render) - More control
- **Docker** (VPS) - Full control

### 6.2 Create Workflows
Following `.claude/agents/n8n-workflow-architect.md`:
1. Instagram data collection
2. Spotify metrics collection
3. TikTok analytics collection

### 6.3 Configure Webhook Triggers
Each workflow triggered by Vercel cron job via webhook.

---

## Phase 7: Testing

### 7.1 Test Database Connection
```bash
npm run test:db
```

### 7.2 Test API Integrations
```bash
npm run test:integrations
```

### 7.3 Test Auth Flow
1. Sign up new user
2. Verify email
3. Login
4. Access dashboard

### 7.4 Test Data Collection
1. Connect Instagram account (OAuth)
2. Trigger n8n workflow
3. Verify data appears in Supabase

### 7.5 Test AI Agents
1. Run brand analyzer
2. Check insights generation
3. Verify cache working

---

## Development Checklist

- [ ] Repository cloned
- [ ] Dependencies installed (`npm install`)
- [ ] `.env.local` created with all secrets
- [ ] Supabase project created
- [ ] Database schema migrated
- [ ] RLS policies enabled
- [ ] Achievement definitions seeded
- [ ] shadcn/ui components installed
- [ ] Supabase client utilities created
- [ ] Middleware configured
- [ ] Vercel project linked
- [ ] Environment variables added to Vercel
- [ ] `vercel.json` cron jobs configured
- [ ] n8n workflows created
- [ ] All integrations tested
- [ ] First test user created
- [ ] Data collection working
- [ ] AI agents generating insights

---

## Next Steps

1. **Build Authentication Pages**: Login, signup, password reset
2. **Build Dashboard**: Main artist dashboard with metrics
3. **Implement Onboarding**: Multi-step onboarding flow
4. **Create AI Agent Endpoints**: API routes for each agent
5. **Build Gamification UI**: XP bars, level display, achievements
6. **Test End-to-End**: Full user journey from signup to insights

---

## Getting Help

- **Agent Guides**: `.claude/agents/` - Specialized agent instructions
- **Planning Docs**: `docs/planning/` - Architecture and feature plans
- **Setup Guides**: `docs/setup/` - Integration and environment setup

Use the specialized Claude agents by calling them in your development workflow!
