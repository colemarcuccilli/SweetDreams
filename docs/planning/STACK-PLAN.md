# Sweet Dreams Music: Complete Stack Plan

## I. Core Functionality (Available to All Users)

### User Accounts & Profiles

**Supabase Auth:** Secure user registration, login, and profile management
- Email/password authentication
- OAuth providers (Google, Discord, Spotify, etc.)
- Magic link authentication
- Session management with JWT tokens
- Role-based access control

**Supabase Database (PostgreSQL):** Store user data
- Contact information
- User preferences and settings
- Profile metadata
- Authentication history

---

### Service Catalog & Booking

**Next.js Front-End (Vercel):** Integrated booking forms and calendars
- Interactive service browsing
- Real-time availability checking
- Calendar integration for scheduling sessions
- Responsive design for mobile and desktop

**Supabase Database:** Store service details
- Service descriptions, pricing, and availability
- Booking records and appointment history
- Staff schedules and resource allocation
- Service categories and tags

**Vercel Serverless Functions:**
- Handle booking logic (checking availability, creating appointments)
- Process booking requests with validation
- Trigger notifications to clients and studio staff upon booking
- Handle webhook events from calendar integrations
- Send email confirmations via Resend

---

### File Management & Sharing

**Next.js Front-End (Vercel):** Interfaces for file operations
- Drag-and-drop file upload
- File browsing and search
- Download and sharing interfaces
- Progress indicators for large uploads

**Supabase Storage:** Securely store project files
- Client stems and raw recordings
- Final mixes and masters
- Video project files
- Reference materials and resources
- Organized folder structure per project/client

**Supabase Database:** Manage file metadata
- File names, sizes, and types
- Upload dates and modification history
- Access permissions and sharing settings
- File relationships (e.g., stems to final mix)

**Cloudflare R2 (Optional):** For very large media files
- Cost-effective storage for bulk video files
- Archival of completed projects
- CDN integration for fast downloads

---

### Payment Processing

**Next.js Front-End (Vercel):** Secure payment interfaces
- Stripe Elements for card input
- Payment form embedded on booking/checkout pages
- Payment history and receipt access
- Subscription management interface

**Stripe:** Payment processing platform
- Handle transactions securely
- Subscription billing for recurring services
- Invoice generation
- Refund processing
- Payment method management

**Vercel Serverless Functions:**
- Process payment requests and communicate with Stripe API
- Handle Stripe webhooks for payment events
- Validate payment data before processing
- Update booking status based on payment confirmation
- Trigger post-payment workflows (confirmations, file access, etc.)

---

### Accounting Integration

**Xero:** Automated accounting via API integration
- Vercel Functions automatically create invoices based on completed bookings
- Record payments from Stripe transactions
- Track expenses and revenue
- Generate financial reports
- Sync client information for accurate billing

**n8n Workflows:**
- Automated workflow to sync Stripe payments to Xero
- Create invoices when bookings are completed
- Update payment status in Xero when Stripe confirms payment
- Generate monthly financial summary reports
- Alert for failed payments or discrepancies

---

## II. Artist Development Features (Unlocked for Specific Clients)

### Client Dashboard

**Next.js Front-End (Vercel):** Personalized dashboard interface
- Real-time analytics visualization
- Interactive charts and graphs (Chart.js, Recharts)
- Goal tracking progress bars
- Task management interface
- AI insights display
- Responsive design optimized for frequent checking
- GSAP animations for celebrations (level-ups, achievements)

**Supabase Database:** Store artist development data
- Growth metrics and KPIs
- Personal goals and milestones
- Task lists and completion status
- AI-generated recommendations and insights
- Historical performance data
- Raw social media and streaming analytics (collected by n8n)
- Processed insights (generated by LangChain agents)

**Supabase Realtime:** Live updates
- Real-time notification of new insights
- Live metric updates as data syncs
- Collaborative features for team members
- Instant level-up animations when XP updates

**Vercel Serverless Functions (LangChain.js AI Agents):**
- `/api/agents/brand-analyzer` — Analyze brand identity and USP
- `/api/agents/content-optimizer` — Content performance analysis
- `/api/agents/audience-analyzer` — Deep audience insights
- `/api/agents/trend-scout` — Trend identification (with Firecrawl)
- `/api/agents/vote-of-confidence` — Personalized encouragement messages
- `/api/agents/path-personalizer` — Customize development path
- `/api/agents/monetization-spotter` — Revenue opportunity finder
- `/api/agents/post-planner` — Generate 7-day post suggestions

**Vercel Crons:** Scheduled automation triggers
- `0 2 * * *` → Trigger n8n data collection workflow
- `0 3 * * *` → Run daily AI analysis for all artists
- `0 4 * * *` → Generate "Vote of Confidence" messages

**n8n Workflows (Data Collection Only):**
- Scheduled data collection from social media platforms:
  - Instagram (Facebook Graph API)
  - TikTok API
  - YouTube Data API
  - Spotify for Artists API
  - Apple Music for Artists API
- Pull email provider stats (Mailchimp, Kit)
- Dump all raw data into Supabase `daily_metrics` table
- **No processing, no AI triggers, no notifications** — just data collection

---

### Gamification System

**Next.js Front-End (Vercel):** Interactive gamification interface
- Avatar customization screen (canvas or SVG composition)
- Level progress visualization (animated with GSAP)
- Cosmetic showcase and selection
- Achievement notifications and celebrations (GSAP-powered)
- Leaderboard (optional, for friendly competition)

**Supabase Database:** Store gamification data
- Avatar data (base model, cosmetics applied)
- Current level and experience points (XP)
- Unlocked cosmetics and achievements
- Milestone history
- Reward inventory

**Supabase Storage:** Store avatar assets
- Base avatar models (PNG/SVG)
- Cosmetic items (clothing, accessories, backgrounds)
- Achievement badges and icons

**Vercel Serverless Functions:**
- Calculate XP based on artist growth metrics
  - Formula: `(new_views * 0.1) + (new_followers * 10) + (engagement * 5)`
- Trigger level-ups when XP thresholds reached
- Unlock cosmetics when criteria are met
- Update user data in Supabase
- Send real-time notifications via Supabase Realtime

**Gamification Triggers (Automated via Vercel Crons):**
- Daily at 3:00 AM, Vercel Function runs gamification calculator
- Reads yesterday's growth from Supabase `daily_metrics`
- Calculates XP and updates `users` table
- Checks for level-ups and achievement unlocks
- Stores unlocked cosmetics in `avatar_cosmetics_unlocked` table
- Triggers Supabase Realtime event for instant dashboard update

---

### Artist Development Path

**Next.js Front-End (Vercel):** Structured development interface
- Visual representation of the development journey
- Interactive milestone checklist
- Resource library with categorized content
- Task detail views with instructions and examples
- Progress tracking visualization

**Supabase Database:** Store development path structure
- Master development path template (stages, milestones, tasks)
- Individual artist progress through the path
- Custom paths tailored by LangChain AI agents or admin
- Task descriptions, resources, and requirements
- Completion timestamps and notes

**Vercel Serverless Functions:**
- Trigger task creation based on artist's current stage
- Deliver relevant resources when unlocked
- Track progress and update database
- Send reminders for incomplete tasks
- Validate task completion criteria

**LangChain.js AI Integration:**
- **Path Personalizer Agent:**
  - Analyzes artist data (progress, strengths, weaknesses, goals)
  - Personalizes the development path (Tier 1-4)
  - Recommends specific milestones, tasks, and resources
  - Adapts path based on actual progress vs. expected progress
- **Multi-Agent System:**
  - Progress Analyzer Agent
  - Task Generator Agent
  - Resource Recommender Agent
  - Coordinated by LangChain orchestrator

---

## III. Technology Stack Summary

### Frontend & Hosting
- **Next.js 14+** (React framework with App Router) - Web application
- **Vercel** - Hosting, deployments, serverless functions, and Crons
- **TypeScript** - Type-safe development
- **Tailwind CSS** - Styling and design system
- **shadcn/ui** - UI component library
- **GSAP** - Advanced animations (homepage, gamification celebrations)

### Backend & Database
- **Supabase** - Backend as a Service
  - **PostgreSQL** database
  - **Auth** (authentication)
  - **Storage** (file hosting)
  - **Realtime** (subscriptions)
  - **Row Level Security** (RLS)
  - **pgvector** (vector embeddings for semantic search)
- **Vercel Serverless Functions** - Primary backend logic and AI agents
- **Cloudflare R2** (Optional) - Object storage for very large files

### AI & Intelligence (NEW STACK)
- **LangChain.js** - AI agent framework (runs in Vercel Functions)
- **OpenAI GPT-4** - Complex reasoning and analysis
- **OpenAI GPT-3.5-Turbo** - Simpler tasks (cost optimization)
- **Anthropic Claude** - Alternative/fallback LLM
- **Firecrawl** - On-demand web scraping (called by LangChain agents)

### Automation & Integrations
- **n8n** - Workflow automation platform (data collection ONLY)
  - Data aggregation from external APIs
  - Scheduled tasks (triggered by Vercel Crons)
  - Webhook handling
  - Third-party API connections
- **Vercel Crons** - Scheduling system (triggers n8n and AI agents)

### External Services
- **Stripe** - Payment processing
- **Xero** - Accounting integration
- **Resend** - Transactional email service

### Additional Tools
- **Zod** - Schema validation
- **React Hook Form** - Form management
- **TanStack Query** (React Query) - Data fetching and caching
- **Zustand** or **Context API** - State management

---

## IV. Simplified Automation Flow

### Daily Workflow (Overnight Processing)

#### 2:00 AM: Data Collection (n8n)

**Trigger:** Vercel Cron hits `/api/cron/trigger-data-collection`

**Flow:**
1. Vercel Function sends webhook to n8n
2. n8n executes data collection workflow:
   - Loop through all active artists in Supabase
   - For each artist:
     - Fetch Instagram stats (followers, engagement, top posts)
     - Fetch TikTok stats (followers, video views, trending sounds)
     - Fetch YouTube stats (subscribers, video views, watch time)
     - Fetch Spotify stats (monthly listeners, playlist adds, top songs)
     - Fetch Apple Music stats (if available)
     - Fetch email provider stats (list size, campaign performance)
   - Insert raw data into Supabase `daily_metrics` table
3. Job complete

**n8n's Role:** Data collection workhorse. No AI, no notifications, no complex logic.

---

#### 3:00 AM: AI Analysis (LangChain Agents)

**Trigger:** Vercel Cron hits `/api/cron/run-daily-analysis`

**Flow:**
1. Vercel Function queries Supabase for all artists needing analysis
2. For each artist, triggers multiple LangChain agents:

**Simple Logic Agent: Gamification Calculator**
- Read yesterday's growth from `daily_metrics`
- Calculate XP: `(new_views * 0.1) + (new_followers * 10) + (engagement * 5)`
- Update `users` table: `xp`, `level`
- Check for level-up; if yes, unlock cosmetic
- Store in `avatar_cosmetics_unlocked` table

**LangChain Agent: Content Performance Analyzer**
- Read last 7 days of post performance from `content_posts` table
- Use GPT-4 to analyze patterns
- Generate insights: "Your BTS studio videos get 2x the engagement of performance clips"
- Store in `ai_insights` table with type: `content_performance`

**LangChain Agent: Audience Analyzer**
- Read demographic data from `daily_metrics`
- Identify shifts: "Your audience is trending younger this week"
- Store insight in `ai_insights` table

**LangChain Agent: Goal Tracker**
- Check if any goals were reached
- If yes, trigger achievement unlock
- Generate congratulatory message

**LangChain Agent: Post Planner (with Firecrawl)**
- Analyze which past posts performed best
- If trend analysis enabled, call Firecrawl to scrape relevant blog
- Use GPT-4 to identify trends and generate 7-day post plan
- Store in `post_planner` table

---

#### 4:00 AM: Personalized Messages

**Trigger:** Vercel Cron hits `/api/cron/generate-votes-of-confidence`

**Flow:**
1. For each artist who gained XP yesterday:
2. LangChain "Vote of Confidence" agent runs
3. Agent prompt includes:
   - XP gained
   - Milestones reached
   - Current tier and goals
   - Recent challenges (if tracked)
4. GPT-4 generates personalized 2-3 sentence message
5. Store in `dashboard_messages` table with type: `vote_of_confidence`

**Example Output:**
> "You gained 127 XP yesterday by staying consistent with your TikTok posts—that's the discipline that separates dreamers from builders. Your 30-day streak is proof you're playing the long game. Question for today: How can you turn your highest-performing content into a weekly series?"

---

### User Journey Flow (Real-Time)

1. **User Actions:**
   - Users interact with the Next.js application (Vercel-hosted)
   - Create accounts, book services, upload files, manage profiles
   - Access artist development features (if eligible)

2. **Front-End Interaction:**
   - Next.js captures user input and displays data
   - Server-side rendering (SSR) for optimal performance
   - Client-side interactivity with React

3. **Backend Logic:**
   - **Vercel Serverless Functions** handle all backend processes:
     - Booking management and validation
     - Payment processing with Stripe
     - File upload authorization
     - Data aggregation and transformation
     - Communication with external APIs
     - Running LangChain AI agents on-demand
     - Managing artist development features
     - Sending email notifications

   - **Supabase** handles:
     - Authentication and session management
     - Database queries with Row Level Security
     - File storage and retrieval
     - Real-time subscriptions for live updates

4. **Data Storage:**
   - **Supabase Database** stores all structured data:
     - Users, bookings, files metadata
     - Artist metrics (raw data from n8n)
     - AI-generated insights (from LangChain agents)
     - Gamification data (XP, levels, cosmetics)
   - **Supabase Storage** stores files (audio, video, images, documents)
   - **Cloudflare R2** stores very large media files (optional)

5. **Automation & AI:**
   - **n8n workflows** (triggered by Vercel Crons):
     - Collect data from social media and streaming platforms
     - Dump raw data into Supabase (no processing)

   - **LangChain agents** (triggered by Vercel Crons or on-demand):
     - Read data from Supabase
     - Call OpenAI/Claude APIs for intelligence
     - Optionally call Firecrawl for web scraping
     - Generate insights, recommendations, personalized messages
     - Store results back in Supabase

6. **Data Display:**
   - Next.js front-end fetches pre-computed data from Supabase
   - Displays AI insights, XP progress, messages, post plans
   - Real-time updates via Supabase Realtime subscriptions
   - Cached data with TanStack Query for optimal performance

---

## V. Security & Performance Considerations

### Security
- **Row Level Security (RLS)** in Supabase ensures users can only access their own data
- **JWT token authentication** for secure API requests
- **HTTPS/TLS encryption** for all data in transit
- **Environment variables** securely stored in Vercel
- **Rate limiting** on Vercel Functions to prevent abuse
- **Input validation** with Zod schemas on both client and server
- **CORS policies** properly configured
- **File upload validation** (file type, size, malware scanning)

### Performance
- **Edge caching** via Cloudflare CDN for static assets (automatic with Vercel)
- **Server-side rendering** with Next.js for fast initial page loads
- **Image optimization** with Next.js Image component
- **Database indexing** in PostgreSQL for fast queries
- **Connection pooling** in Supabase for efficient database access
- **Lazy loading** for heavy components and images
- **Code splitting** to reduce initial bundle size
- **TanStack Query caching** to minimize redundant API calls
- **Pre-computed insights** (overnight processing) for instant dashboard loads

### Scalability
- **Serverless architecture** (Vercel Functions) auto-scales with demand
- **PostgreSQL** handles complex queries and large datasets efficiently
- **n8n workflows** can be horizontally scaled (self-hosted or cloud)
- **Supabase** designed for high-volume applications
- **LangChain agents** scale per invocation (no persistent server)
- **Vercel Crons** handle scheduling reliably at scale

---

## VI. Development Workflow

### Version Control & CI/CD
- **Git** for version control (GitHub/GitLab)
- **Vercel** automatic deployments on Git push
- **Preview deployments** for every pull request
- **Environment separation** (development, staging, production)
- **Database migrations** with Supabase CLI
- **Vercel Crons** configuration via `vercel.json`

### Testing
- **Unit tests** with Vitest or Jest
- **Integration tests** for API routes and Vercel Functions
- **LangChain agent tests** with mock LLM responses
- **End-to-end tests** with Playwright or Cypress
- **API testing** with Postman or similar tools

### Monitoring & Logging
- **Vercel Analytics** for front-end performance
- **Vercel Function Logs** for serverless function execution
- **Supabase Dashboard** for database metrics
- **n8n execution logs** for workflow monitoring
- **Error tracking** with Sentry or similar service
- **LLM API usage tracking** (OpenAI/Claude dashboards)
- **Uptime monitoring** with Uptime Robot or Pingdom

---

## VII. Cost Optimization Strategies

### OpenAI/Claude API Costs
- Use **GPT-4** only for complex reasoning (audience analysis, trend identification)
- Use **GPT-3.5-Turbo** for simpler tasks (basic insights, simple recommendations)
- Implement **caching** for repeated queries
- **Batch process** artists (analyze 100 artists in one function invocation)
- **Prompt optimization** to reduce token usage

### Vercel Function Optimization
- Use **Vercel Pro plan** for 60-second timeout (vs. 10 seconds on Hobby)
- Warm-up functions periodically to avoid cold starts
- Optimize function code for fast execution
- Use **edge functions** for simple, latency-sensitive tasks

### n8n Cost Control
- **Self-host** n8n for maximum cost control
- Or use n8n Cloud with appropriate plan
- Optimize workflows to minimize execution time

### Supabase Optimization
- Implement **database indexes** for frequently queried columns
- Use **connection pooling** efficiently
- Archive old data to reduce database size
- Utilize **Supabase Storage** for files (cheaper than S3)

---

This comprehensive stack plan provides a robust, scalable, and cost-effective foundation for Sweet Dreams Music. By leveraging **custom-built LangChain.js AI agents** instead of pre-built services, we maintain full control, reduce long-term costs by 40-90%, and build proprietary intelligence that embodies our philosophy and serves as our competitive advantage.

**This is the right path. Not the easy path.**
